package com.projeto.academia.beans;

import java.util.Set;

import javax.annotation.PostConstruct;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.crypto.password.PasswordEncoder;

import com.projeto.academia.model.Role;
import com.projeto.academia.model.Usuario;
import com.projeto.academia.repository.UsuarioRepository;

public class AdminInitializerBean {
	   @Autowired
	    private UsuarioRepository usuarioRepository;

	    @Autowired
	    private PasswordEncoder passwordEncoder; // Inject a PasswordEncoder

	    @PostConstruct
	    public void createAdminUser() {
	        if (usuarioRepository.loadByUserName("admin").isEmpty()) {
	            Usuario admin = new Usuario();
	            admin.setUsername("admin");
	            admin.setPassword("admin"); // Hash the password
	            Role role=new Role();
	            role.setRole("ADMINISTRADOR");
	            admin.setRole(Set.of(role));
	            usuarioRepository.save(admin);
	            System.out.println("Admin user created.");
	        } else {
	            System.out.println("Admin user already exists.");
	        }
	    }
}
